<div id="map-container" class="hidden">
    <div id="map-view">
        <div id="top-bar">
            <button id="btn-back-to-dashboard-from-map" class="btn btn-primary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
                Retour
            </button>
            
            <div id="clock">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                <span id="current-time">--:--:--</span>
                <span id="date-indicator">--</span>
            </div>

            <div id="top-right-controls">
                <div id="status-info">
                    <span id="bus-count">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/></svg>
                        0 bus
                    </span>
                    <span id="data-status">En attente...</span>
                </div>

                <button id="map-theme-toggle-btn" class="topbar-pill map-theme-toggle" data-theme-toggle="true" aria-label="Basculer le thÃ¨me" aria-pressed="false" title="ThÃ¨me sombre">
                    <span class="theme-toggle-icon" aria-hidden="true">ðŸŒ™</span>
                    <span class="theme-toggle-label">ThÃ¨me</span>
                </button>
            </div>
        </div>

        <div id="mode-banner" class="hidden"></div>
        <div id="map"></div>
    </div>
    
    <!-- V76: Bouton Filtrer sorti du top-bar pour positionnement fixe correct sur mobile -->
    <button id="btn-toggle-filter" class="btn map-fab-button">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"/></svg>
        <span>Filtrer</span>
    </button>
    
    <div id="route-filter-panel" class="hidden">
        <div class="panel-handle"></div>
        <div class="filter-header">
            <h3>Filtrer les lignes</h3>
            <button id="close-filter" class="btn-close">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
            </button>
        </div>
        <div class="filter-actions">
            <button id="select-all-routes" class="btn-small">Toutes</button>
            <button id="deselect-all-routes" class="btn-small">Aucune</button>
        </div>
        <div id="route-checkboxes" class="route-list"></div>
    </div>

    <div id="instructions" class="hidden">
        <div class="instruction-content">
            <div class="instruction-header">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
                <h3>Instructions</h3>
            </div>
            <ol>
                <li>Placez vos fichiers GTFS dans <code>/public/data/gtfs/</code></li>
                <li>Placez votre fichier GeoJSON dans <code>/public/data/map.geojson</code></li>
                <li>RafraÃ®chissez la page</li>
                <li>Les bus en circulation s'affichent automatiquement</li>
                <li>Cliquez sur un bus pour voir la ligne, le prochain arrÃªt et la destination</li>
            </ol>
            <button id="close-instructions">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                Fermer
            </button>
        </div>
    </div>

    <div id="install-tip" class="install-tip hidden" role="dialog" aria-modal="true" aria-labelledby="install-tip-title">
        <div class="install-tip-card">
            <div class="install-tip-header">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
                <div>
                    <p class="install-tip-badge">Ajouter Ã  l'Ã©cran d'accueil</p>
                    <h3 id="install-tip-title">Installer PÃ©riMap</h3>
                </div>
            </div>
            <p class="install-tip-lede">Vous Ãªtes revenu sur le hall. Suivez les Ã©tapes ci-dessous pour ajouter PÃ©riMap Ã  votre Ã©cran d'accueil.</p>
            <div class="install-tip-steps">
                <section>
                    <h4>Sur iOS (Safari)</h4>
                    <ol>
                        <li>Appuyez sur <strong>Partager</strong> (icÃ´ne carrÃ© + flÃ¨che).</li>
                        <li>Choisissez <strong>Sur l'Ã©cran d'accueil</strong>.</li>
                        <li>VÃ©rifiez le nom <strong>PÃ©riMap</strong> et validez avec <strong>Ajouter</strong>.</li>
                    </ol>
                </section>
                <section>
                    <h4>Sur Android (Chrome/Edge)</h4>
                    <ol>
                        <li>Ouvrez le menu <strong>â‹®</strong>.</li>
                        <li>SÃ©lectionnez <strong>Installer l'application</strong> ou <strong>Ajouter Ã  l'Ã©cran d'accueil</strong>.</li>
                        <li>Confirmez ; l'icÃ´ne PÃ©riMap apparaÃ®t parmi vos apps.</li>
                    </ol>
                </section>
            </div>
            <button id="install-tip-close" class="btn btn-primary">J'ai compris</button>
        </div>
    </div>
</div>
